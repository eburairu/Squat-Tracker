# 要件定義書

## 機能概要
ローカルストレージに保存されているトレーニング履歴、設定、プリセット、ボスバトルの進行状況などのデータを、JSONファイルとしてエクスポート（バックアップ）およびインポート（復元）できる機能を提供する。
これにより、ブラウザのキャッシュクリアやデバイス変更時のデータ移行を可能にする。

## ユーザーストーリー
- ユーザーとして、これまでのトレーニング記録をバックアップしたい。なぜなら、スマホの買い替えなどでデータが消えるのを防ぎたいから。
- ユーザーとして、バックアップファイルからデータを復元したい。なぜなら、新しいデバイスでも続きからトレーニングを行いたいから。

## 機能要件

### 要件1：データエクスポート
- 「設定」または「データ管理」セクションに「データのエクスポート（保存）」ボタンを配置する。
- ボタンを押下すると、ローカルストレージ内の `squat-tracker-` で始まるキーのデータを収集する。
- 収集したデータをJSON形式に変換し、ファイルとしてダウンロードさせる。
- ファイル名は `squat-tracker-backup-YYYY-MM-DD.json` の形式とする（日付は当日）。
- 受入基準：
  - [ ] エクスポートボタンが表示されていること
  - [ ] ボタン押下によりJSONファイルがダウンロードされること
  - [ ] ファイル名に日付が含まれていること
  - [ ] JSONファイル内に `squat-tracker-history-v1` などの主要データが含まれていること

### 要件2：データインポート
- 「設定」または「データ管理」セクションに「データのインポート（復元）」ボタンを配置する。
- ボタンを押下すると、ファイル選択ダイアログが表示される。
- ユーザーがJSONファイルを選択すると、内容を検証する（JSONとしてパース可能か）。
- インポート実行前に「現在のデータは上書きされます」という旨の確認ダイアログを表示し、ユーザーの同意を得る。
- 同意が得られた場合、ファイル内のデータをローカルストレージに書き込む（キーが一致するものは上書き、新規キーは追加）。
- 書き込み完了後、ページをリロードして反映させる。
- 不正なファイル形式の場合はエラーメッセージを表示する。
- 受入基準：
  - [ ] インポートボタンが表示されていること
  - [ ] ファイル選択後に確認ダイアログが表示されること
  - [ ] 正しいJSONファイルをインポートすると、ローカルストレージの値が更新されること
  - [ ] インポート後に画面がリロードされ、データ（履歴件数や設定値など）が反映されていること
  - [ ] 不正なファイルを選択した際にエラーが表示されること

### 要件3：UI/UX
- 新しい「データ管理」カードを追加し、そこにボタンを配置する。
- ボタンのデザインは既存のスタイルに合わせる。

## 非機能要件
- セキュリティ：インポート時に悪意あるスクリプトなどが実行されないよう、単純な文字列データとしてローカルストレージに保存する（読み込み時に `eval` せず `JSON.parse` を使用する）。
- ユーザビリティ：直感的に操作できること。
