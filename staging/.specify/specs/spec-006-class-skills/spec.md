# 仕様書: クラス・アクティブスキル (Class Active Skills)

## 1. 概要
クラス（職業）システムに能動的なアクション要素を追加し、RPGとしての戦略性と没入感を高める。
各クラスに固有の「アクティブスキル」を付与し、トレーニング（セッション）中に任意のタイミングで1回だけ発動できるようにする。

## 2. 目的
- **ユーザー体験の向上**: パッシブ効果のみだったクラス選択に、より明確なプレイ感の違いを生む。
- **救済措置**: クイズが苦手なユーザー（魔法使い）や、ボスを早く倒したいユーザー（戦士）に、状況打破の手段を提供する。
- **戦略性**: 「いつスキルを使うか」という判断要素を加え、単調になりがちなトレーニングにメリハリをつける。

## 3. 機能要件

### 3.1 スキル定義
各クラスに以下の固有スキルを割り当てる。

| クラス | スキル名 | 効果概要 | 詳細仕様 |
| :--- | :--- | :--- | :--- |
| **冒険者** | 深呼吸 (Deep Breath) | テンション回復 | テンションゲージを **50%** 即時回復する。 |
| **戦士** | パワーサージ (Power Surge) | 攻撃力強化 | 発動した**セットの間**、攻撃力が **1.5倍** になる。セット終了時に効果終了。 |
| **魔法使い** | 予知 (Foresight) | クイズ必勝 | 発動後の**次のクイズ**が自動的に「正解（クリティカル）」扱いとなる。 |
| **盗賊** | 強運 (Fortune) | クリティカル＆ドロップ | 次の攻撃が**確定クリティカル**となり、アイテムドロップ判定の確率が上昇（または判定回数増加）する。 |

### 3.2 発動条件・制限
- **回数制限**: 1ワークアウト（セッション）につき **1回のみ** 使用可能。
- **発動タイミング**:
  - ワークアウト進行中（スタート後、リザルト前）かつ、フェーズが `IDLE` 以外であること。
  - 一時停止中も発動可能とする（再開後に適用）。

### 3.3 データ構造
`classes.json` に `skill` オブジェクトを追加する。
```json
"skill": {
  "id": "skill_warrior",
  "name": "パワーサージ",
  "description": "今のセット中、攻撃力1.5倍",
  "type": "buff_attack",
  "value": 1.5
}
```

## 4. UI/UX要件

### 4.1 メイン画面への配置
- ヒーローパネル (`.hero-panel`) 内、ステータスグリッドの下に「スキルボタン」を配置する。
- ボタンにはスキルアイコン（絵文字）とスキル名を表示する。

### 4.2 状態表示
- **使用可能**: 通常表示。押下可能。
- **使用済み**: グレーアウトし、押下不可。「USED」等のバッジを表示。
- **発動時**:
  - ボタンがアニメーション（パルス等）する。
  - トースト通知 (`showToast`) で発動メッセージを表示。
  - 効果音（バフ音）を再生。

### 4.3 クラス変更時の挙動
- ワークアウト中にクラスを変更することは仕様上できない（または推奨されない）が、もし変更された場合はスキル使用回数はリセットされず、新しいクラスのスキルも（すでに使用済みなら）使用できないものとする。
- *簡略化のため*: ワークアウト開始時にスキル情報を固定（スナップショット化）し、途中でクラスを変えてもそのセッション中は開始時のスキルを使用する仕様とする。

## 5. エッジケース・非機能要件
- **リセット時**: ワークアウトをリセットした場合、スキル使用回数もリセット（再使用可能）に戻す。
- **効果の重複**:
  - 戦士スキル（x1.5）とブーストモード（x1.5）は乗算される（x2.25）。
  - これにより爽快なダメージ体験を提供する。

## 6. 将来拡張性
- スキルレベル制の導入（熟練度に応じて効果UP）。
- 複数回使用可能になるアイテムの実装。
