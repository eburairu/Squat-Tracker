# デイリー運勢システム (Daily Fortune System) 仕様書

## 1. 目的
ユーザーが毎日アプリを起動し、トレーニングを開始する動機付けを行う。「今日は運が良いから頑張ろう」というポジティブなきっかけを提供する。

## 2. ユーザー体験 (UX)
1. ユーザーはアプリを起動する。
2. 画面上部のステータスパネルに「運勢」アイコン（未実施時は「運試し」）が表示されている。
3. アイコンをタップするとモーダルが開き、「おみくじを引く」ボタンが表示される。
4. ボタンを押すと、簡易的なアニメーション（おみくじ箱を振るなど）が表示される。
5. 結果（大吉〜末吉）が表示され、本日のボーナス効果が通知される。
6. モーダルを閉じると、ステータスパネルのアイコンが結果（例：「大吉」）に変化する。
7. トレーニング中、攻撃力や取得経験値にボーナスが適用される。

## 3. 機能要件

### 3.1 抽選機能
- 1日1回、0:00〜23:59の間に1度だけ実行可能。
- 以下の確率・効果で抽選を行う（確率は調整可能とする）。

| 運勢 | 確率 | 攻撃力倍率 | 経験値倍率 | その他効果 |
| :--- | :--- | :--- | :--- | :--- |
| 大吉 (Excellent) | 10% | 1.5倍 | 1.5倍 | - |
| 中吉 (Great) | 25% | 1.2倍 | 1.2倍 | - |
| 小吉 (Good) | 30% | 1.1倍 | 1.0倍 | - |
| 吉 (Lucky) | 25% | 1.0倍 | 1.0倍 | テンション初期値 +20% |
| 末吉 (Normal) | 10% | 1.0倍 | 1.0倍 | 一言コメントのみ |

### 3.2 状態管理
- `localStorage` に以下のデータを保存する。
  - Key: `squat-tracker-fortune`
  - Value: `{ date: "YYYY-MM-DD", result: "大吉", effects: { attack: 1.5, exp: 1.5, tension: 0 } }`
- アプリ起動時、保存された日付が当日でない場合は状態をリセットする。

### 3.3 効果適用
- **攻撃力**: `BossBattle` のダメージ計算時に倍率を乗算する。
- **経験値**: `ClassManager` の経験値加算時に倍率を乗算する。
- **テンション**: トレーニング開始時 (`startWorkout`) に初期値を加算する。

### 3.4 UI表示
- **ステータスパネル**:
  - 未実施: 「運試し 🥠」
  - 実施済: 「[結果名] 🌸」
- **モーダル**:
  - 未実施: 抽選ボタン表示
  - 実施済: 結果と効果を表示

## 4. 非機能要件
- **パフォーマンス**: モーダル表示や抽選処理は即座に行われること。
- **永続化**: ブラウザを閉じても当日は結果が維持されること。
- **オフライン**: 通信を行わず、ローカルで完結すること。

## 5. エッジケース
- **日付変更**: アプリ起動中に日付が変わった場合、次回のアクション（リロードや再フォーカス）でリセット判定が行われることが望ましいが、必須ではない（次回起動時で良い）。
- **データ破損**: localStorageのデータが不正な場合は、未実施状態として扱う。
