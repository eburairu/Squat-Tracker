# Spec: スマート・プランナー (Smart Planner)

## 概要
ユーザーの過去のトレーニング履歴、現在のレベル、ボスの残りHPなどのデータに基づき、その日に最適なトレーニングメニュー（セット数、回数、秒数）を自動的に生成・提案する機能。
「今日は何をしよう？」という迷いをなくし、目標達成（ボス討伐など）に向けた能動的なコーチングを提供する。

## データ要件

### 入力データ
1.  **トレーニング履歴 (`historyEntries`)**
    -   直近5件程度の `totalReps`, `totalSets`, `repsPerSet` を参照。
    -   最終トレーニング日時 (`date`) を参照し、経過日数を計算。
2.  **ボス状態 (`BossBattle.state`)**
    -   `currentHp`: ボスの残りHP。
    -   `maxHp`: ボスの最大HP。
3.  **ユーザーレベル (`userLevel`)**
    -   現在のレベル（基礎攻撃力の算出に使用）。

### 出力プラン
提案は以下の3つのモードで生成される。

| プラン名 | 概要 | 適用シーン | 負荷設定（目安） |
| :--- | :--- | :--- | :--- |
| **Challenge** | 挑戦 | ボス撃破目前、レベルアップ直前、調子が良い時 | 直近平均 × 1.1〜1.2 |
| **Maintain** | 維持 | 通常時、継続重視 | 直近平均 × 1.0 |
| **Light** | リハビリ/軽量 | 久しぶり（3日以上空いた）、不調時 | 直近平均 × 0.7〜0.8 |

※ 履歴がゼロの場合は、デフォルト設定（3セット × 10回）をベースに提案する。

## ロジック詳細

1.  **基準負荷の算出 (`baseLoad`)**
    -   直近3〜5回のトレーニングの「総負荷（セット数×回数）」の平均値を算出。
    -   履歴がない場合は `30` (3セット×10回) を基準とする。

2.  **係数の適用**
    -   **Challenge**: `baseLoad * 1.2`
        -   もし `BossBattle.currentHp` が `baseLoad * 1.2 * 攻撃力` で倒せる範囲なら、倒しきれる数値を優先設定する。
    -   **Maintain**: `baseLoad * 1.0`
    -   **Light**: `baseLoad * 0.8`

3.  **セット数・回数の配分**
    -   総負荷を基に、セット数と回数を逆算する。
    -   基本はセット数を `3` 固定とし、回数を調整するが、回数が多すぎる（例: 30回超）場合はセット数を増やす（例: 4セット, 5セット）。
    -   1セットあたりの最大回数は `50` までとする。

## UI仕様

### エントリーポイント
-   **場所**: `#control-card` 内、プリセット選択の前。
-   **コンポーネント**:
    ```html
    <div class="control-group smart-plan-group">
      <div class="smart-plan-header">
        <label class="preset-label">AIコーチ提案</label>
        <button id="smart-plan-button" class="btn primary small">
          ⚡️ メニューを提案
        </button>
      </div>
      <p class="smart-plan-desc">今の状態に最適なメニューを作成します。</p>
    </div>
    ```

### モーダル (`#smart-plan-modal`)
-   **タイトル**: 「本日の推奨メニュー」
-   **内容**: 3つのプランカードを横並び（スマホでは縦積み）で表示。
-   **カード構成**:
    -   **アイコン**: 🔥(Challenge), ⚖️(Maintain), 🌱(Light)
    -   **タイトル**: 「挑戦」「維持」「軽め」
    -   **詳細**: 「4セット × 12回 (計48回)」など
    -   **メッセージ**: 「ボス撃破まであと少し！」「ペースを崩さずいきましょう」「まずは体を慣らしましょう」
    -   **選択ボタン**: 「適用する」
-   **挙動**:
    -   「適用する」をクリックすると、モーダルを閉じ、`#set-count`, `#rep-count` 等の入力フォームに値を反映させる。
    -   反映後、トースト通知を表示する（例: 「プラン『挑戦』を適用しました！」）。

## 非機能要件
-   **パフォーマンス**: 計算はクライアントサイドで即座に行う。
-   **依存性**: 外部APIは使用しない。
