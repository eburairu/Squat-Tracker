# コンボシステム仕様書 (Rhythm Combo System)

## 1. 目的
スクワットの「リズム感」と「継続性」を可視化し、ユーザーのトレーニングへの没入感と集中力を高める。
単調になりがちな動作にゲーム的な緊張感と爽快感を付与する。

## 2. 機能要件

### 2.1 コンボの定義
- **開始条件**: クイズ正解、またはクイズなしモードでのスクワット（1セットの動作完了）成功時にコンボカウントを開始。
- **加算条件 (+1)**:
  - クイズモードON時: クイズに正解した瞬間。
  - クイズモードOFF時: スクワットの「Up」フェーズが完了し、次のレップに進む瞬間。
- **維持条件**:
  - フェーズ間の休憩時間。
  - 一時停止中（ポーズ）。
- **リセット条件 (0に戻る)**:
  - クイズモードON時: クイズに不正解だった場合（お邪魔モード/協力モード問わず）。
  - トレーニングをリセットした場合。
  - （将来拡張）センサーモードで判定失敗した場合。

### 2.2 ボーナス効果
コンボ数に応じて、以下のボーナスを付与する。
- **テンション増加量アップ**:
  - 10コンボ毎に、基本のテンション増加量（攻撃時+10）に +5 のボーナスを加算。
  - 計算式: `TensionBonus = Math.floor(CurrentCombo / 10) * 5`
- **演出強化**:
  - 10コンボ、30コンボ、50コンボ、100コンボ到達時に、特別なサウンドエフェクトや視覚効果（文字色変化など）を発生させる。

### 2.3 UI仕様
- **表示位置**: 画面中央上部、またはキャラクターの頭上付近。
- **表示内容**: 「XX COMBO!」というテキスト。
- **アニメーション**:
  - カウントアップ時: 文字が拡大してから元のサイズに戻る（Pulse効果）。
  - リセット時: 文字が崩れる、または「MISS...」と表示されてフェードアウト。
- **色変化**:
  - 0-9: 通常色（白/黒）
  - 10-29: 青（Blue）
  - 30-49: 黄（Yellow）
  - 50+: 赤（Red）/虹色（Rainbow）

## 3. データ構造
`ComboSystem` モジュール（シングルトン）で管理。
- `currentCombo`: 現在のコンボ数（整数）
- `maxCombo`: セッション中の最大コンボ数（整数、リザルト用）

## 4. エッジケース
- **セッション終了時**: コンボ数はリセットされるが、最大コンボ数は記録として残す（将来的にリザルト画面に表示）。
- **アプリ再読み込み**: コンボ数は保持されない（0からスタート）。

## 5. 非機能要件
- **パフォーマンス**: アニメーションがフレームレートを低下させないこと（CSS transformを使用）。
- **レスポンシブ**: スマートフォン画面でも視認性を確保し、他のUI要素（タイマー、キャラクター）と重ならないこと。
