# Spec-001: Weekly Challenge System

## 1. 目的
ユーザーの継続率向上を目的とし、既存の「デイリーミッション」に加え、1週間単位で達成を目指す「ウィークリーチャレンジ」を導入する。
短期的な目標（デイリー）と中期的な目標（ウィークリー）を組み合わせることで、週末に向けてのモチベーション維持を図る。

## 2. 機能要件

### 2.1 スケジュールとリセット
- **期間**: 月曜日 00:00 〜 日曜日 23:59
- **リセット**: 毎週月曜日の初回起動時に、新しいミッションが生成される。
- **持越し**: 達成途中のミッションはリセット時に破棄され、報酬も受け取れなくなる。

### 2.2 ミッション生成
- 毎週3つのミッションがランダムに選出される。
- **ミッションタイプ**:
  1. **合計回数**: 1週間でスクワット合計 N 回 (例: 300, 500, 700)
  2. **ログイン日数**: 1週間で N 日起動する (例: 3日, 5日)
  3. **ボス討伐**: 特定のボス種別、または任意のボスを N 体倒す (例: 5体)
  4. **消費カロリー**: 推定消費カロリー N kcal 達成 (例: 100kcal)

### 2.3 報酬
- デイリーミッションよりも豪華な報酬を設定。
- **確定報酬**: レアリティ3以上の武器、または武器強化素材（既存システムに素材がない場合は高レベル武器）。
- 演出: 報酬獲得時に特別なエフェクト（紙吹雪など）を表示。

### 2.4 データ永続化
- `localStorage` キー: `squat-tracker-weekly-challenge`
- 保存データ構造:
  ```json
  {
    "lastUpdatedWeek": "2023-W42", // ISO週番号または月曜日の日付
    "missions": [
      {
        "id": "weekly_2023-W42_0",
        "type": "total_reps",
        "description": "今週合計300回スクワット",
        "target": 300,
        "current": 150,
        "unit": "回",
        "completed": false,
        "claimed": false,
        "rewardType": "weapon_rare"
      }
    ]
  }
  ```

## 3. UI仕様

### 3.1 ミッションカードの改修
- 既存の `#mission-card` 内にタブ切り替え機能を追加。
  - **[今日のミッション]** タブ
  - **[今週の挑戦]** タブ
- ウィークリータブ選択時:
  - ヘッダー付近に「残り日数: X日」を表示。
  - ミッションリストを表示（デザインはデイリーと共通だが、アクセントカラーを変えるなどで差別化）。

### 3.2 通知
- ミッション達成時にトースト通知を表示。
- 未受け取り報酬がある場合、タブにバッジを表示（余裕があれば）。

## 4. エッジケース
- **週の途中で初回起動**: その時点から週末までの残り日数で挑戦開始（難易度調整は行わない仕様とする）。
- **時計操作**: ユーザーが端末時間を操作した場合、過去・未来のミッション生成が起きる可能性があるが、許容する（チート対策は厳密に行わない）。

## 5. 技術的制約
- `js/modules/daily-mission.js` とコード重複を避けるため、可能な限り共通ロジックを使用するか、構造を似せる。ただし今回は影響範囲を抑えるため、別モジュール `js/modules/weekly-challenge.js` として実装し、`DailyMissionSystem` とは疎結合にする。
