# 仕様書: 次回の誓い (Next Commitment)

## 1. 概要
ユーザーが次回のトレーニングを行う日時を事前に「誓約（コミットメント）」する機能。
約束を守ることでゲーム内ボーナスを獲得し、破ることでペナルティを受ける仕組みを導入することで、
継続への強力な動機づけを行う。

## 2. 目的
- ユーザーの「いつやるか」という意思決定コストを下げる。
- 「約束を守る」という心理的強制力を利用して継続率を向上させる。
- ゲームプレイのサイクルにメリハリをつける。

## 3. 機能要件

### 3.1 誓約の設定
- **タイミング:** ワークアウト完了画面（Finish Phase）および手動設定。
- **入力:**
  - クイック選択: 「明日」「明後日」
  - 日時指定: カレンダー/時刻選択
  - スキップ: 「誓わない」も可能
- **保存:** ローカルストレージに保存。

### 3.2 誓約の確認と表示
- **トップ画面:**
  - 次回の誓約がある場合、ターゲット日時までの残り時間、または超過時間を表示する。
  - 表示場所: ヒーローエリアまたはアドベンチャーステータス付近。

### 3.3 判定と結果
アプリ起動時（またはワークアウト開始時）に判定を行う。

- **成功 (Fulfilled):**
  - 条件: 誓約した日時の範囲内（例: 当日中、または指定時刻の前後X時間）にワークアウトを開始した。
  - ※今回はシンプルに「誓約日時以前、または誓約日時の当日中」に開始すれば成功とする。
  - 報酬:
    - 次回セッションの攻撃力 +10% (Session Attack Bonus)
    - テンションゲージ +50% スタート
    - 専用トースト通知「約束を守りました！ボーナス獲得！」

- **失敗 (Broken):**
  - 条件: 誓約日時（の当日23:59）を過ぎてアプリを開いた、またはワークアウトを開始した。
  - ペナルティ:
    - ボスのHPが追加で回復する（「ボスは待ちくたびれて元気が余っている！」）
    - 専用トースト通知「約束が破られました...ボスが回復しました」
  - ※ 失敗判定後、誓約データはクリアされる（または失敗履歴として残る）。

- **猶予:**
  - 誓約日時よりかなり早く（例: 前日）来た場合は、「早めに来て偉い！」として成功扱いにする。

## 4. データ構造 (localStorage)

Key: `squat-tracker-commitment`

```json
{
  "targetTimestamp": 1715439600000, // 誓約した日時
  "createdTimestamp": 1715353200000, // 誓約を作成した日時
  "status": "pending" // pending, fulfilled, broken
}
```

## 5. UI仕様

### 5.1 誓約設定モーダル
- 完了画面で「次回の予定を決めますか？」と表示し、ボタンを押すとモーダル展開。
- ボタン: 「明日やる」「明後日やる」「日時指定」「今は決めない」

### 5.2 ステータス表示
- ヒーローヘッダー内に「Next Mission: MM/DD HH:mm」のようなバッジを表示。
- 残り時間に応じて色を変える（Safe: 緑, Warning: 黄, Over: 赤）。

## 6. エッジケース
- **誓約の上書き:** 既に誓約がある状態で再度設定しようとした場合、上書き確認を行う。
- **日付変更線:** クライアントのローカル時刻に依存する。
- **ブラウザのデータ削除:** データが消えた場合は誓約も消滅する（ペナルティは発生しない）。
