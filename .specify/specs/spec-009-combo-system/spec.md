# 機能仕様書: コンボシステム

**機能ブランチ**: `feat/combo-system`
**作成日**: 2024-05-24
**ステータス**: Draft
**入力**: ユーザー要件: "新しい価値を生むための機能企画"

## ユーザーストーリー & テスト

### ユーザーストーリー 1 - リズム継続によるコンボ蓄積 (優先度: P1)

ユーザーとして、リズムに合わせてトレーニングを中断せずに続けることで、画面上に「コンボ」が積み上がるのを確認し、達成感と集中力を高めたい。

**優先度の理由**: 本機能の核となる体験であり、単調な動作にゲーム性を持たせるため。

**独立テスト**: コンボカウンターの実装と、一時停止/再開時の挙動を確認することで検証可能。

**受け入れシナリオ**:

1. **Given** トレーニングを開始する, **When** 1回目のスクワット（UPフェーズ）を完了する, **Then** コンボ数が「1」と表示される。
2. **Given** コンボ数が「5」の状態, **When** さらに1回スクワットを完了する, **Then** コンボ数が「6」になる。
3. **Given** コンボ数が「10」の状態, **When** 「一時停止」ボタンを押す, **Then** コンボ数が「0」にリセットされる。

---

### ユーザーストーリー 2 - クイズ結果との連動 (優先度: P2)

ユーザーとして、計算クイズに正解することでコンボを継続し、不正解時にはコンボが途切れる緊張感を味わいたい。

**優先度の理由**: 脳トレ要素と身体動作の連携を強化し、クイズへの真剣度を高めるため。

**独立テスト**: クイズ正誤判定時のコンボ増減ロジックを検証する。

**受け入れシナリオ**:

1. **Given** コンボ数が「3」の状態, **When** クイズに正解する, **Then** コンボ数が維持される（または加算される）。
2. **Given** コンボ数が「5」の状態, **When** クイズに不正解になる, **Then** コンボ数が「0」にリセットされ、フィードバック（「Combo Lost...」等）が表示される。

---

### ユーザーストーリー 3 - コンボボーナスの適用 (優先度: P2)

ユーザーとして、積み上げたコンボ数に応じて攻撃力やテンションゲージにボーナスを得て、ボスを倒しやすくしたい。

**優先度の理由**: コンボを続ける実利的なメリットを提供し、モチベーションを最大化するため。

**独立テスト**: ダメージ計算ロジックにおけるコンボ補正値の適用を確認する。

**受け入れシナリオ**:

1. **Given** コンボ数が「10」の状態, **When** 攻撃を行う, **Then** 通常時よりも高いダメージ（例: +10%）が与えられる。
2. **Given** コンボ数が「20」に到達する, **When** その瞬間, **Then** テンションゲージに追加のボーナス（例: +10）が付与される。

---

### エッジケース

- **休憩中**: セット間の休憩中はコンボ数は維持される（リセットされない）。
- **トレーニング終了**: トレーニング完了時、最終コンボ数がリザルト画面等に表示される（今回は必須ではないが考慮）。
- **不正解時のリセット**: クイズ不正解でリセットされた直後のRep完了時、コンボは「1」から再スタートする。

## 要件

### 機能要件

- **FR-001**: システムは、スクワットの1回完了（UPフェーズ終了）ごとにコンボ数を1加算しなければならない (MUST)。
- **FR-002**: システムは、ユーザーが「一時停止」を行った場合、現在のコンボ数を0にリセットしなければならない (MUST)。
- **FR-003**: システムは、クイズ不正解時にコンボ数を0にリセットしなければならない (MUST)。
- **FR-004**: システムは、現在のコンボ数を画面上の目立つ位置（例: フェーズ表示付近）に表示しなければならない (MUST)。
- **FR-005**: システムは、コンボ数に応じたダメージボーナス（例: 1コンボにつき+1%、最大+50%など）を計算し、攻撃時に適用しなければならない (MUST)。
- **FR-006**: システムは、特定のコンボ数（例: 10の倍数）到達時に、テンションゲージを加算しなければならない (SHOULD)。

### 主要エンティティ

- **ComboSystem**: コンボの現在値、最大値、ボーナス計算ロジックを管理するシングルトンまたはモジュール。

## 成功基準

### 測定可能な成果

- **SC-001**: トレーニング中に一時停止せず1セット（10回）完了した場合、コンボ数が「10」になっていること。
- **SC-002**: クイズ不正解時に即座にコンボ表示がリセットされること。
- **SC-003**: 10コンボ時のダメージが、0コンボ時と比較して計算通りのボーナス値（例: 1.1倍）になっていること。
