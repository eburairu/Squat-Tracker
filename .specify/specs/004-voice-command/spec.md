# 仕様書: 音声コマンド操作 (Voice Command Control)

## 1. 概要
トレーニング中、ユーザーが画面に触れることなく音声コマンドによってアプリケーションの主要な操作（開始、一時停止、リセット）を行えるようにする機能。

## 2. 目的・背景
スクワット中はスマートフォンから数メートル離れた位置に立つことが多く、操作のたびに移動する必要がある。これはトレーニングのリズムを崩し、集中力を削ぐ要因となっている。ハンズフリー操作を実現することで、UXを劇的に改善し、トレーニングへの没入感を高める。

## 3. 機能要件

### 3.1 音声認識エンジン
- ブラウザ標準の Web Speech API (`SpeechRecognition` または `webkitSpeechRecognition`) を利用する。
- 日本語 (`ja-JP`) の音声を認識対象とする。

### 3.2 コマンドとアクション
以下のキーワードを認識し、対応するアクションを実行する。

| 音声コマンド (例) | 対応アクション | 備考 |
| :--- | :--- | :--- |
| 「スタート」「開始」 | トレーニング開始 (`startWorkout`) | 待機状態 (`Phase.IDLE`) でのみ有効 |
| 「ストップ」「止めて」「一時停止」 | 一時停止/再開 (`pauseWorkout`) | トレーニング中のみ有効 |
| 「リセット」「最初から」「やめる」 | リセット (`resetWorkout`) | 一時停止中または終了後に有効 |

※ 誤認識防止のため、可能な限り完全一致に近い判定を行う。

### 3.3 ユーザーインターフェース (UI)
- **設定トグル**: 音声操作機能の ON/OFF を切り替えるスイッチを画面上部または設定内に配置する。
- **ステータス表示**: マイクが音声をリッスン中であることを示す視覚的インジケーター（アイコンの点滅や色変化など）を表示する。
- **フィードバック**: コマンドが認識され実行された際、Toast通知や効果音でユーザーにフィードバックを行う。

### 3.4 設定の永続化
- 音声操作の ON/OFF 設定は `localStorage` に保存し、次回起動時に復元する。

## 4. 非機能要件

### 4.1 ブラウザ互換性
- `SpeechRecognition` API に対応していないブラウザでは、本機能の設定UIを非表示にする、または「非対応」と明示して無効化する。
- 主なターゲット: Google Chrome (PC/Android), Microsoft Edge, Safari (iOS/macOS - 部分的サポートの可能性あり)。

### 4.2 セキュリティ・権限
- マイク使用許可をユーザーに求める。許可が拒否された場合は機能を無効化し、適切なメッセージを表示する。
- 動作環境は HTTPS (または localhost) が必須であるため、GitHub Pages での運用を前提とする。

### 4.3 誤認識対策
- 連続認識 (`continuous = true`) ではなく、必要に応じて再開するか、あるいは単発認識を繰り返す方式を検討し、環境音による誤作動を最小限に抑える。
- 信頼度 (`confidence`) のチェックを行い、低品質な認識結果は破棄する（閾値設定）。

## 5. ユースケース

### シナリオA: 完全ハンズフリー・ワークアウト
1. ユーザーはスマホをセットし、少し離れた位置に立つ。
2. 「スタート」と発話し、カウントダウンを開始させる。
3. トレーニングを行う。
4. 終了後、「リセット」と発話して次のセットに備える。

### シナリオB: 緊急停止
1. トレーニング中、急な来客や電話があった。
2. 即座に「ストップ」と発話し、カウントを一時停止する。
3. 用事が済んだら「再開（ストップと同じコマンドでトグル）」または画面タップで再開する。
