# 仕様書: アドベンチャーモード「ルート選択」機能

## 1. 概要
アドベンチャーモードの進行中に「分岐イベント」を発生させ、プレイヤーが次に進むルートを選択できる機能を追加する。
これにより、プレイヤーは自身の体調やモチベーションに合わせて、ゲームの難易度（リスク）と報酬（リターン）を自律的に調整できるようになる。

## 2. 目的
- **自己効力感の向上**: 「やらされる」のではなく「自分で選ぶ」体験を提供する。
- **継続性の維持**: 体調が悪い時は「安全な道」、調子が良い時は「険しい道」を選ぶことで、無理なく継続できるようにする。
- **戦略性の強化**: 報酬アップのためにあえて高難易度を選ぶといった戦略的なプレイを可能にする。

## 3. 機能要件

### 3.1 分岐イベントの発生
- **発生タイミング**:
  - エリア移動時（新しいエリアに入った直後）。
  - または、エリア内進行度が 50% に達した時点（今回は実装の単純化のため、**エリア開始時**とする）。
- **トリガー**: `AdventureSystem.advance()` がエリア切り替えを行った際、または初回開始時に、自動的に選択モードへ移行する。

### 3.2 ルートの種類とパラメータ補正
以下の3種類のルートを基本とする。

| ルート名 | 説明 | 敵HP補正 | 経験値補正 | ドロップ率補正 |
| :--- | :--- | :--- | :--- | :--- |
| **王道 (Normal)** | 通常のルート。バランスが良い。 | 1.0倍 | 1.0倍 | 1.0倍 |
| **修羅の道 (Hard)** | 敵が強いが、見返りも大きい。 | 1.5倍 | 1.5倍 | 1.2倍 |
| **裏道 (Easy)** | 敵は弱いが、実入りは少ない。 | 0.8倍 | 0.8倍 | 1.0倍 |

※ 経験値（Class Mastery EXP）への補正は、`ClassManager` 連携時に考慮する（今回はまず敵HPへの反映を優先）。
※ ドロップ率補正は、レアリティ抽選の重み付けに影響させる。

### 3.3 状態管理
- 選択されたルート情報は `AdventureSystem` の `state` に保存する。
- 保存項目:
  - `currentRouteId`: 選択中のルートID（例: 'normal', 'hard', 'easy'）。
  - `routeModifiers`: 適用中の補正値オブジェクト。
- LocalStorage キー `squat-tracker-adventure` に含まれる形で永続化する。

### 3.4 ボスバトルへの反映
- `BossBattle` モジュールがモンスターを生成（`spawnMonster`）する際、`AdventureSystem` から現在のHP補正値を取得し、MaxHPに乗算する。
- 撃破時の報酬計算（今回は実装スコープ外とするが、将来的に経験値計算へ反映）にも利用可能にする。

## 4. UI/UX要件

### 4.1 ルート選択モーダル
- **表示**: 分岐イベント発生時に画面中央にモーダルを表示。
- **要素**:
  - タイトル（例：「分かれ道だ！」）
  - 選択肢カード（3つ並べる）
    - アイコン/絵文字
    - ルート名
    - 説明文（「敵HP x1.5 / EXP x1.5」など）
    - 選択ボタン
- **挙動**:
  - 選択するまで閉じられない（必須選択）。
  - 選択後、モーダルが閉じ、通常のアドベンチャー画面（またはボス出現演出）へ遷移する。

## 5. エッジケース
- **初回起動時**: チュートリアル的な扱いで、デフォルトで「王道」が選択された状態、あるいは初回から選択させる。今回は「初回から選択させる」挙動とする。
- **データ不整合**: 保存データにルート情報がない場合は「王道」として扱う。
