# 仕様書: ストリークシールド (Streak Shield)

## 1. 概要
ユーザーの継続記録（ストリーク）を保護するための消費アイテム「ストリークシールド」を導入する。
トレーニングを行わなかった日があっても、シールドを消費することで「継続」扱いとし、モチベーションの断絶を防ぐ。

## 2. 背景・目的
- **課題**: 1日でもトレーニングを休むと、これまで積み上げた「連続記録日数」が0になり、ユーザーの喪失感が大きく、離脱の原因となる。
- **解決策**: RPG要素として「身代わりアイテム」を導入し、適度な救済措置を提供する。
- **価値**: 心理的安全性（休んでも大丈夫）と、アイテム収集（シールドを集めておく）という新たな楽しみを提供する。

## 3. 仕様詳細

### 3.1. アイテム定義
- **名称**: ストリークシールド (Streak Shield)
- **アイコン**: 🛡️
- **分類**: 消費アイテム (`consumables`)
- **所持上限**: 5個（仮）

### 3.2. 自動消費ロジック
アプリ起動時（`AdventureSystem` または `App` 初期化時）に以下を判定する：

1. **最終トレーニング日** を確認。
2. 最終日が「昨日」より前（例：一昨日）の場合、未実施期間（昨日、一昨日...）が存在する。
3. 未実施期間の各日について、**シールドを所持** していれば：
    - シールドを1つ消費。
    - その日付で「シールド使用履歴」を作成し、トレーニング履歴 (`history`) に保存する。
    - ユーザーに「シールド発動！連続記録が守られました」と通知（Toast）する。
4. シールドが足りない場合は、そこでストリークが途切れる（既存動作）。

### 3.3. データ構造の変更
- **InventoryManager**:
    - `consumables` プロパティを追加し、`shield` の個数を管理する。
- **History (localStorage)**:
    - 従来の履歴エントリは `{ date: ISOString, totalReps: number, ... }`。
    - シールド使用エントリとして `{ date: ISOString, type: 'shield', totalReps: 0 }` を追加可能にする。

### 3.4. 継続日数計算 (`computeStreak`)
- 履歴データを走査する際、`type: 'shield'` のエントリも「実施済み」とみなしてカウントする。

### 3.5. UI/UX
- **インベントリ**: シールドの所持数を表示する（既存の武器一覧とは別に、ステータス欄やヘッダーに追加、あるいは武器モーダル内にタブ追加）。
    - 今回は **ヘッダーのステータスエリア（Lvなどの近く）** にシールドアイコンと個数を表示する。
- **通知**: 自動消費された際に通知を表示。

## 4. ユースケース
- **UC-01**: ユーザーが昨日トレーニングを忘れ、今日アプリを開いた。シールドを持っていたため、自動的に消費され、連続日数が維持された状態で表示される。
- **UC-02**: ユーザーがシールドを持っていない状態で2日ぶりにアプリを開いた。連続日数はリセットされる。

## 5. 入手方法（今回はデバッグ/暫定）
- **初期配布**: 新機能リリース記念として、初回起動時にシールドを1個付与する。
- **デバッグ**: コンソールから付与可能にする。
- （将来拡張）: ボス討伐時の低確率ドロップ、7日連続達成ボーナスなど。

## 6. エッジケース
- **長期不在**: 1ヶ月ぶりに起動した場合、シールドが5個あっても全て消費するか？
    - -> **仕様**: 所持している分だけ消費し、直近の日付を埋める。それでも繋がらなければストリークは切れるが、履歴上の「穴」は埋まる。
    - 優先度: 「昨日」から過去に遡って埋める。
