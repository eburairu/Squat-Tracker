# Squat Analytics 機能仕様書

## 1. 概要
ユーザーの過去のトレーニング履歴（`localStorage`）を分析し、自身の「行動パターン」や「成長推移」を可視化する機能。
単なる記録の閲覧にとどまらず、データに基づいた具体的な「アドバイス（インサイト）」を提供することで、ユーザーの習慣化とモチベーション向上を支援する。

## 2. 目的
- **習慣化の促進**: 自分がサボりやすい曜日や時間帯を認識させ、対策を促す。
- **成長の実感**: 長期的な積み重ねを可視化し、自己効力感を高める。
- **コーチング体験**: アプリが専属トレーナーのように振る舞い、ユーザーに寄り添う体験を提供する。

## 3. 機能要件

### 3.1 データ分析 (`AnalyticsManager`)
`localStorage` の `squat-tracker-history-v1` を読み込み、以下の指標を計算する。

1.  **週間アクティビティ (Weekly Activity)**
    - 曜日ごとの合計実施回数（またはセット数）。
    - 過去全期間または直近3ヶ月などの範囲指定が可能であること（初期リリースでは全期間で良い）。

2.  **時間帯別パフォーマンス (Hourly Performance)**
    - 以下の4つの区分ごとの実施回数分布。
        - 朝 (05:00 - 10:59)
        - 昼 (11:00 - 16:59)
        - 夜 (17:00 - 22:59)
        - 深夜 (23:00 - 04:59)

3.  **月間推移 (Monthly Trend)**
    - 直近6ヶ月間の月別合計回数の推移。

### 3.2 インサイト生成 (`InsightGenerator`)
分析結果に基づき、以下のルールでメッセージを生成する。

- **称賛**: 特定の曜日や時間帯に集中して実施できている場合（「火曜日はあなたのゴールデンタイムです！」）。
- **激励**: 特定の曜日だけ実施率が低い場合（「水曜日を乗り越えれば完璧です！」）。
- **提案**: 長期間ブランクがある場合や、夜遅すぎる場合のアドバイス。

### 3.3 グラフ描画 (`ChartRenderer`)
外部ライブラリを使用せず、SVG (Scalable Vector Graphics) を動的に生成してグラフを描画する。

- **棒グラフ (Bar Chart)**: 週間アクティビティ用。
- **折れ線グラフ (Line Chart)**: 月間推移用。
- **円グラフ (Pie Chart) または 積み上げ棒**: 時間帯別用（今回はシンプルな棒グラフでも可とする）。

### 3.4 UI/UX
- **アクセス**: メイン画面（または実績画面）に「分析レポート」ボタンを配置。
- **表示形式**: モーダルウィンドウ (`#analytics-modal`) で表示。
- **レイアウト**:
    - ヘッダー: タイトルと閉じるボタン。
    - インサイトセクション: アバター（またはアイコン）と吹き出しでアドバイスを表示。
    - チャートセクション: 各グラフをカード形式で配置。

## 4. 非機能要件
- **パフォーマンス**: 1年分（約365エントリー）のデータを瞬時に計算・描画できること。
- **依存関係**: Chart.js などの外部ライブラリは使用しない（バンドルサイズ削減のため）。
- **レスポンシブ**: スマホ画面でもグラフが見切れないこと。SVGの `viewBox` を活用する。

## 5. データ構造

### 5.1 入力データ形式 (既存)
```json
[
  {
    "date": "2023-10-27T10:00:00.000Z",
    "totalReps": 30,
    "duration": 120,
    ...
  }
]
```

### 5.2 出力データ形式 (分析結果)
```javascript
{
  weekly: [100, 200, 50, 0, 300, 150, 400], // 日〜土の合計回数
  hourly: { morning: 10, day: 20, night: 50, late: 5 },
  monthly: [ { label: '5月', value: 1000 }, ... ],
  insight: { type: 'praise', message: '...' }
}
```

## 6. エッジケース
- **データなし**: 新規ユーザーで履歴が空の場合、「データが足りません。まずはトレーニングを始めましょう！」と表示し、グラフは空またはプレースホルダーを表示する。
- **極端な偏り**: 特定の日しかやっていない場合でもグラフが崩れないようにスケーリングする。
