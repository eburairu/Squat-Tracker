# Spec: 実況解説システム (Live Commentary System)

## 概要
トレーニング中の孤独感を解消し、RPGバトルの臨場感を高めるための「実況解説システム」。
単なるカウント読み上げではなく、コンボ継続、クリティカルヒット、ピンチ、勝利などの戦況に応じて動的に実況を行うことで、ユーザーのモチベーションを維持・向上させる。

## データ要件

### 実況データ (`js/data/commentary-lines.json`)
状況ごとに複数のセリフパターンを定義する。

```json
{
  "start": ["実況席からお送りします！", "さあ、伝説の戦いが始まります！"],
  "combo_10": ["いい調子だ！", "流れるようなフォーム！"],
  "combo_50": ["止まらない！", "まさに無双状態！"],
  "critical": ["会心の一撃！", "強烈な一撃が入った！"],
  "pinch": ["踏ん張りどころだ！", "諦めるな！"],
  "boss_damage_50": ["敵の動きが鈍ってきたぞ！", "半分削った！"],
  "boss_damage_20": ["あと少しだ！トドメを刺せ！", "敵は虫の息だ！"],
  "win": ["見事な勝利だ！", "伝説の誕生だ！"],
  "lose": ["惜しかった...", "次は勝てる！"]
}
```

## 機能仕様

### 1. CommentaryManager
-   シングルトンまたは静的クラスとして実装。
-   `VoiceCoach` を内部で利用して発話を行う。
-   **発話キュー**: 同時に複数のイベントが発生した場合、優先度順に処理し、重要でない発話はスキップまたは遅延させる。

### 2. 発話トリガーと優先度
高い優先度のイベントは、現在の発話をキャンセルしてでも割り込む（または直後に再生する）。

| トリガー | 条件 | 優先度 | 備考 |
| :--- | :--- | :--- | :--- |
| **Countdown** | スタート前、休憩明け | **高 (High)** | 実況は控える (VoiceCoachが担当) |
| **Phase Change** | フェーズ切り替え (Down/Up) | **中 (Medium)** | VoiceCoachが担当 |
| **Win/Lose** | バトル終了時 | **中 (Medium)** | 必ず再生したい |
| **Boss HP** | 残りHP 50%, 20% | **低 (Low)** | コンボより優先 |
| **Combo** | 10, 20, 30...回継続 | **低 (Low)** | 頻度が高いので間引く可能性あり |
| **Critical** | クリティカル発生 | **低 (Low)** | 確率で再生 |
| **Pinch** | 残り時間が少ない (10秒以下) | **中 (Medium)** | 盛り上げ用 |

### 3. クールダウン制御
-   同じ種類のイベント（例：コンボ）が短時間に連続して発生しても、全て実況するとうるさいため、**最低発話間隔（クールダウン）** を設ける。
-   例: コンボ実況は最低でも10秒空ける。

### 4. 設定
-   **ON/OFF**: 設定パネルで実況の有効/無効を切り替え可能。
-   デフォルトは **OFF**（ユーザーが能動的にONにする）。

## UI仕様

### 設定パネルへの追加
-   `#voice-control-group` 付近にトグルスイッチを追加。
-   ラベル: 「実況解説」
-   ID: `#commentary-toggle`

## 非機能要件
-   **パフォーマンス**: ゲームループ (`tick`) に負荷をかけない。
-   **音声合成**: ブラウザの `SpeechSynthesis` API を使用。音声のロード待ちやエラーで停止しないこと。

## エッジケース
-   **音声合成非対応ブラウザ**: エラーにならず、静かに機能を無効化する。
-   **連続イベント**: ボスHP50%とコンボ10回が同時に発生した場合、優先度の高い方（ボスHP）を優先し、他方は破棄する（またはキューに積むが、キューが長すぎれば破棄）。
