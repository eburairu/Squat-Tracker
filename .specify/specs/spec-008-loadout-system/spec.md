# 仕様: 装備マイセット（ロードアウト）機能

## 1. 概要
ユーザーが現在の「クラス」「武器」「称号」の組み合わせを「マイセット（ロードアウト）」として保存し、ワンタップで呼び出せる機能を提供する。これにより、ボス戦やレベル上げなど、目的に応じた装備変更の手間を削減し、戦略的なプレイを促進する。

## 2. 背景・課題
- RPG要素（クラス、スキル、属性など）が拡充されるにつれ、状況に応じた装備変更の頻度が増加している。
- 現状、装備を変更するには「クラス変更」「武器変更」「称号変更」の各画面を個別に操作する必要があり、手間がかかる。
- この手間が心理的ハードルとなり、最適な戦略を試すことを阻害している。

## 3. 要件定義

### 3.1 機能要件
1.  **保存機能**
    - 現在装備している「クラスID」「武器ID」「称号Prefix ID」「称号Suffix ID」を取得し、セットとして保存できる。
    - セットには任意の名前を付けることができる（デフォルト名は「マイセット {N}」）。
    - 最大保存数は 5件 とする。
    - 既存のセットを選択して上書き保存が可能。

2.  **呼び出し機能**
    - 保存されたセットの一覧を表示する。
    - セットを選択して「適用」すると、装備が一括で変更される。
    - 適用時、関連するマネージャー（ClassManager, InventoryManager, TitleManager）の状態が更新され、UIにも即座に反映される。
    - 未所持の装備が含まれている場合（データ不整合時など）、その装備のみデフォルト（素手など）に戻るか、適用をスキップする（基本は所持チェックを行う）。

3.  **削除機能**
    - 不要になったセットを削除できる。

4.  **永続化**
    - マイセットデータは `localStorage` に保存される。
    - キー: `squat-tracker-loadouts`

### 3.2 UI要件
- **マイセットボタン**: ステータス画面やメニュー内に「マイセット」ボタンを配置。
- **マイセット管理モーダル**:
    - セット一覧リスト（名前、クラスアイコン、武器アイコンを表示）。
    - 「現在の装備を新規保存」ボタン。
    - 各セットに対する「適用」「削除」「名前変更（任意）」アクション。

### 3.3 非機能要件
- **パフォーマンス**: モーダル展開やセット適用は遅延なく行われること（100ms以内）。
- **信頼性**: 保存データの破損を防ぐため、JSONパースエラー時のハンドリングを行う。

## 4. データ構造

```json
// localStorage: squat-tracker-loadouts
{
  "loadouts": [
    {
      "id": "uuid-v4-string",
      "name": "対ボス決戦用",
      "classId": "warrior",
      "weaponId": "dragon_sword",
      "titlePrefixId": "legendary",
      "titleSuffixId": "hero",
      "createdAt": 1678888888888
    }
  ]
}
```

## 5. エッジケース
- **装備未所持**: 保存後にデータを削除したり、別端末で同期されなかった場合などで、保存されているIDの装備を所持していない場合。
    - **対応**: 適用時に `InventoryManager` 等の検証メソッドを通し、未所持なら適用せずエラーメッセージを表示、あるいはデフォルト装備を適用する。今回は「未所持ならその部位は変更しない」または「デフォルトに戻す」とする。
- **データ破損**: localStorageのデータが不正な場合。
    - **対応**: 初期化（空リスト）して復旧する。
