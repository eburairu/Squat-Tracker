# spec-013-optimize-loadout.md

## 概要
ユーザーが所持しているアイテムや解放済みのクラス・称号の中から、攻撃力が最大になる組み合わせを自動的に計算し、適用する機能を追加する。

## 目的
RPG要素が複雑化する中で、最適な装備構成を考える手間を省き、手軽に最強状態でプレイできるようにする。

## 機能要件
1.  **最強装備の自動選択**
    *   **武器**: 所持している武器の中で、現在のレベルにおける攻撃力が最大のものを選択する。
    *   **クラス**: 解放済みのクラスの中で、攻撃倍率（基本倍率 + スキルツリー補正）が最大のものを選択する。
    *   **称号**: 解放済みの称号（Prefix, Suffix）の組み合わせで発動するシナジーのうち、攻撃倍率上昇量が最大のものを選択する。
    *   上記の3要素を組み合わせて装備する。

2.  **UI**
    *   「マイセット管理」モーダル (`#loadout-modal`) 内に、「⚡️ 最強装備を適用」ボタン (`#optimize-loadout-btn`) を追加する。
    *   ボタン押下時に計算と適用を行い、結果をトースト通知で表示する。

3.  **除外条件**
    *   未所持の武器、未開放のクラス、未開放の称号パーツは選択対象外とする。

## 技術的仕様
*   **InventoryManager**: `state.items` を走査し、`weaponsData` を参照して攻撃力を算出。
*   **ClassManager**: `getModifiers` メソッドを拡張し、シナジー補正を除外した純粋なクラス補正を取得できるようにする。
*   **TitleManager**: `getBestSynergy` メソッドを追加し、攻撃倍率シナジーを検索する。
*   **LoadoutManager**: 上記マネージャーを統括し、最適化ロジックを実行する。

## テスト計画
*   Playwrightテスト (`tests/loadout-optimization.spec.js`) を作成。
    *   初期装備（弱い状態）からボタン押下で最強装備（強い状態）に変化することを確認。
    *   未所持アイテムが選ばれないことを確認。
