# Spec: ゴースト・ペースメーカー (Ghost Pacemaker)

## 概要
ユーザーが過去のトレーニング記録（自己ベストや前回の記録）や、設定した目標ペースとリアルタイムで競走できる「ゴースト」機能。
トレーニング中の進捗状況（プログレスバー）上に「ゴースト」のアイコンを表示し、視覚的に競争を行うことでモチベーションを向上させる。

## データ要件

### 1. 履歴データの拡張 (`historyEntries`)
既存の履歴データには「いつ各レップを完了したか」という時系列情報が含まれていないため、これを追加する。

-   **追加フィールド**: `timeline` (Array of numbers)
    -   各レップ（またはセット）が完了した時点の経過時間（ミリ秒）を記録する。
    -   例: `[5000, 10000, 15000, ...]` （5秒、10秒、15秒時点でレップ完了）

### 2. ゴーストデータの生成 (`GhostData`)
ゴーストの実体は「時間経過に対する進捗率（またはレップ数）」のマッピングデータである。

-   **入力ソース**:
    -   **Past Record (Replay)**: 過去の `timeline` データを使用し、そのペースを完全再現する。
    -   **Average Pace (Calculated)**: 過去の `totalReps` と `duration` から平均ペースを算出し、等速で進むゴーストを生成する（`timeline` データがない古い履歴用）。
    -   **Target Pace**: 設定した目標時間内に完了するペースで進むゴースト。

## 機能仕様

### 1. ゴーストの選択
トレーニング開始前（スタートボタン押下時、または設定画面）に、対戦するゴーストを選択する。
今回は **MVP (Minimum Viable Product)** として、以下のロジックで自動選択（または固定）する。

-   **優先順位 1**: 前回のトレーニング記録（同じメニュー設定の場合）。
-   **優先順位 2**: 過去の平均ペース（履歴がある場合）。
-   **優先順位 3**: なし（初回または履歴なし）。

※ 将来的には「自己ベスト」「昨日の自分」「ライバル」などを選択可能にする。

### 2. リアルタイム表示
-   **場所**: 画面上部のプログレスバー (`#progress-bar`)。
-   **表現**:
    -   **プログレスバー**: プレイヤーの進捗（既存）。
    -   **ゴーストマーカー**: プログレスバー上に重なる形で、ゴーストの現在位置を示すアイコン（👻）を表示する。
    -   **位置計算**: `(現在の経過時間 / ゴーストの総時間) * 100%`。ただし、Replayモードの場合は `timeline` に基づくステップ進行とする。

### 3. 勝敗判定
トレーニング完了時に、ゴーストと比較して「勝ち（先行）」か「負け（遅れ）」かを判定し、フィードバックを行う。

-   **判定基準**: 全レップ完了時点のタイム差。
-   **フィードバック**:
    -   終了画面（トースト通知またはリザルト画面）で「ゴーストに 5秒 勝利！🎉」のように表示。
    -   勝利時ボーナス（将来拡張用: テンションボーナスなど）。

## UI仕様

### プログレスバー拡張
```html
<div class="progress-container">
  <div id="progress-bar" class="progress-bar"></div>
  <!-- 追加: ゴーストマーカー -->
  <div id="ghost-marker" class="ghost-marker">👻</div>
</div>
```

### スタイル (CSS)
-   `.ghost-marker`: 絶対配置 (`position: absolute`)。`left` プロパティで位置を制御。
-   アニメーション: スムーズな移動のために `transition: left 0.5s linear` を適用。

## 非機能要件
-   **パフォーマンス**: 毎フレーム (`tick`) の計算負荷を最小限にする。
-   **互換性**: 古い履歴データ（`timeline` なし）でもエラーにならず、平均ペース（Average Pace）モードで動作すること。

## エッジケース
-   **一時停止**: プレイヤーが一時停止した場合、ゴーストも停止するべきか？
    -   **仕様**: ゴーストは「実時間」ではなく「トレーニング経過時間（一時停止除く）」で進行するため、プレイヤーが一時停止すればゴーストも止まる（相対的な競争）。
-   **オーバーペース**: ゴーストが先にゴールした場合、マーカーは100%位置で停止する。
