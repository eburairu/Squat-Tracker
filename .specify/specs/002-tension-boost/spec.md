# 仕様書: テンション・ブースト・システム (Tension Boost System)

## 1. 概要
トレーニング中の単調さを解消し、ユーザーのモチベーションを高めるために、スクワット回数やクイズ正解に応じて「テンション」が蓄積し、MAXになると一時的に能力が強化される「テンション・ブースト・システム」を導入する。

## 2. 目的
- **爽快感の提供**: ゲーム的な演出により、トレーニングの楽しさを向上させる。
- **短期目標の創出**: 「あと少しでブースト」という直近の目標を持たせ、セッション後半の離脱を防ぐ。
- **価値の可視化**: ユーザーの努力（Rep数、正解数）を視覚的フィードバックとして即座に還元する。

## 3. 機能要件

### 3.1 テンション蓄積ロジック
- **初期値**: 0
- **最大値**: 100
- **増加条件**:
  - **Rep完了時**: 攻撃処理 (`performAttack`) が実行されたタイミングで **+10** 増加。
  - **クイズ正解時**: クイズに正解したタイミングで **+20** 増加。
  - **ミスの扱い**: クイズ不正解時や、中断時による減少は設けない（ポジティブフィードバックのみ）。

### 3.2 ブースト発動
- **発動条件**: テンション値が **100** に達した瞬間、自動的に発動する。
- **継続時間**: **30秒間**。
- **効果**:
  - **攻撃力上昇**: ユーザーの最終攻撃力（武器補正込み）に対し、**1.5倍** の補正をかける。
  - **演出**: 画面全体、またはステータス表示部に「ブースト中」を示す視覚エフェクト（発光、オーラ等）を表示する。

### 3.3 終了処理
- 30秒経過後、通常モードに戻る。
- テンション値は **0** にリセットされる。
- トレーニングセッション終了 (`finishWorkout`) 時は、ブースト中であっても強制終了し、リセットする。

## 4. 非機能要件
- **パフォーマンス**: アニメーション追加による再描画負荷を最小限に抑える（`transform`, `opacity` プロパティの活用）。
- **レスポンシブ**: モバイル端末の狭い画面でも、テンションゲージが主要な情報（タイマー、問題文）を隠さないこと。

## 5. UI/UX仕様
- **テンションゲージ**:
  - 配置: 画面下部、またはヘッダー付近の視認性の良い場所。
  - 表現: プログレスバー形式。現在値を視覚的に表示。
  - アニメーション: 増加時にスムーズに伸びるアニメーション。
- **ブースト時**:
  - ゲージが発光する（CSSクラス `boost-active` 等の付与）。
  - 可能であればToast等で「BOOST START!」を表示。

## 6. データ構造設計
`TensionManager` クラスによる単一責任管理を行う。

```javascript
class TensionManager {
  constructor() {
    this.value = 0;
    this.maxValue = 100;
    this.isActive = false;
    this.boostDuration = 30000;
    this.boostMultiplier = 1.5;
  }

  add(amount) { ... }
  activate() { ... }
  updateUI() { ... }
}
```

## 7. テスト計画
- **E2Eテスト**: Playwrightを使用。
  - ゲージが初期状態で0であること。
  - スクワット（攻撃）によりゲージが増えること。
  - 100に達した時点でブースト状態（クラス付与等）になること。
  - ブースト中に攻撃力が上がっていること（ログ出力やToast確認が困難な場合は、内部状態の露出等で検証）。
