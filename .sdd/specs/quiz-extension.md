# 計算問題の拡張仕様

## 1. 概要

現在の計算問題機能を拡張し、回答を4択の選択式にする。また、「協力モード」と「お邪魔モード」を導入し、計算問題の正否がボスバトルやスクワットのカウントに影響するように変更する。

## 2. UIの変更

### 2.1. 計算問題エリア (`workout-card`)

-   `quiz-area` 内に、回答の選択肢を表示するための4つのボタンを配置する。
-   これらのボタンは `quiz-options-container` というコンテナ要素に内包する。
-   各ボタンには `quiz-option` クラスを付与する。
-   計算問題の回答者は画面上部から操作するため、選択肢のコンテナは `flex-direction: column-reverse;` とし、要素の表示順を上下反転させる。

### 2.2. モード切替エリア (`control-card`)

-   「ワークアウト設定」カード内に、協力モードとお邪魔モードを切り替えるためのトグルスイッチを追加する。
-   トグルスイッチのIDは `quiz-mode-toggle` とする。
-   ラベルには現在のモード（例：「協力モード」）を表示し、ID `quiz-mode-label` を付与する。

## 3. 機能仕様

### 3.1. 計算問題の生成

-   `quiz.js` の `generateQuiz` 関数を拡張する。
-   これまで通り、問題文と正解を生成する。
-   正解とは異なる3つの不正解な選択肢を自動生成する。
    -   不正解な選択肢は、正解の値に近い値や、計算間違いを誘発するような値とする（例：`a + b` に対し `a - b` や `a * b`）。
    -   選択肢が重複しないようにする。
    -   必ず1つの正解と3つの不正解が生成されるようにする。
-   生成された4つの選択肢（正解1つ、不正解3つ）をランダムな順序で配列として保持する。

### 3.2. 問題の表示と回答

-   セッションの `DOWN` フェーズで新しい問題と選択肢を生成し、画面に表示する。
-   `quiz-option` ボタンに、ランダム化された選択肢の値を設定する。
-   ユーザーが選択肢のボタンをクリックすると、正解・不正解の判定を行う。
-   回答後、ボタンは一時的に無効化し、選択したボタンの背景色を変更して正否をフィードバックする。
    -   正解：緑色 (`var(--success-color)`)
    -   不正解：赤色 (`var(--error-color)`)
-   `UP` フェーズで正解のテキストを表示する際には、全ての選択肢のスタイルをリセットする。

### 3.3. モード別効果

#### 3.3.1. 協力モード (デフォルト)

-   計算問題に正解すると、そのセッション中の次のボスへの攻撃に攻撃力ボーナスが付与される。
-   ボーナスの値は `+1` とする。このボーナスは重複して累積する。
-   セッションが終了すると、ボーナスはリセットされる。
-   不正解の場合、特にペナルティはない。

#### 3.3.2. お邪魔モード

-   計算問題に正解しても、特別な報酬はない。
-   計算問題に不正解すると、その回のスクワットがカウントされなくなるペナルティが発生する。
-   `UP` フェーズが完了しても `rep` (回数) が増加しないように制御する。

### 3.4. 状態管理

-   現在のクイズモード（協力 or お邪魔）を管理する状態変数を導入する。
-   セッション中の攻撃力ボーナスを管理する一時的な状態変数を導入する。
-   クイズに回答済みかどうかのフラグを管理し、1つの問題に複数回回答できないようにする。

## 4. 実装モジュール

-   `index.html`: 新しいUI要素の追加
-   `styles.css`: 新しいUI要素のスタイリング
-   `js/modules/quiz.js`: 問題生成、選択肢生成、正否判定ロジックの追加
-   `js/app.js`: UIイベントハンドラ、モード切替、ボスバトルやスクワットカウントへの影響を連携させるロジックの追加
-   `js/modules/workout-timer.js`: お邪魔モード時のスクワットカウント制御
-   `js/modules/boss-battle.js`: 協力モード時の攻撃力ボーナス反映
