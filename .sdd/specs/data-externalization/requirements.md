# 要件定義書: データ外部化 (実績・武器)

## 概要
現在 JavaScript コード内にハードコードされている「実績 (Achievements)」および「武器 (Weapons)」のデータを、JSON ファイルとして外部化し、アプリケーション起動時に動的に読み込むように変更する。これにより、エンジニア以外のメンバーでも設定ファイルの編集のみでコンテンツの追加・削除が可能になることを目指す。

## 目的
1.  **保守性の向上**: データとロジックを分離し、コードの複雑性を下げる。
2.  **拡張性の向上**: JSON ファイルを編集するだけで、新しい実績や武器を追加可能にする。
3.  **非エンジニア対応**: プログラムコードを触らずにコンテンツ調整ができる基盤を作る。

## 要件

### 1. 実績データの JSON 化
*   既存の `js/modules/achievement-system.js` 内の `badges` 配列を `js/data/achievements.json` に移行する。
*   関数で記述されている「達成条件 (`condition`)」を、JSON で表現可能なスキーマ（データ構造）に変換する。
    *   例: `condition: (ctx) => ctx.totalReps >= 100`  -> `{"type": "TOTAL_REPS", "value": 100}`
*   サポートすべき条件タイプ:
    *   `TOTAL_REPS`: 累計回数
    *   `STREAK`: 連続日数
    *   `BOSS_KILLS`: ボス討伐数
    *   `BOSS_TYPE_KILLS`: 特定種類のボス討伐
    *   `LEVEL`: ユーザーレベル
    *   `SETTINGS`: 設定値 (休憩時間、セット数など)
    *   `TIME`: 特定の時間帯 (早朝、深夜など)
    *   `CUSTOM`: 特殊条件 (センサーモード、バックアップ等) - 既存ロジックへのマッピングで対応

### 2. 武器データの JSON 化
*   既存の `js/constants.js` 内の `BASE_WEAPONS` 配列を `js/data/base-weapons.json` に移行する。
*   `js/data/weapons.js` の `generateWeapons` 関数は、定数ではなく読み込んだデータを受け取って武器リストを生成するように変更する。
*   `RARITY_SETTINGS` は今回はコード内に残すが、将来的な分離も考慮した構造とする。

### 3. データ読み込みの非同期化
*   アプリケーション起動時 (`js/app.js`) に `fetch()` API を使用して JSON ファイルをロードする。
*   データロードが完了するまで、依存するモジュール（`AchievementSystem`, `InventoryManager` 等）の初期化を遅延させる、またはロード完了を待機する仕組みを実装する。

### 4. 既存機能の維持
*   現在実装されている全ての実績が、JSON 化後も正しく機能すること。
*   武器一覧が正しく生成され、インベントリや攻撃力計算に反映されること。

## 非機能要件
*   **パフォーマンス**: JSON ファイルの読み込みによる起動時間の遅延を最小限に抑える（ファイルサイズは小さいため大きな問題にはならない想定）。
*   **エラーハンドリング**: JSON ファイルの読み込みに失敗した場合や、JSON の構文エラーがあった場合、適切なエラーメッセージを表示するか、デフォルト値（または空）で動作し、アプリ全体がクラッシュしないようにする。
